"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[266],{58266:function(e,t,r){r.d(t,{y:function(){return W}});var n=r(99892),o=Uint8Array,a=Uint16Array,s=Int32Array,i=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(e,t){for(var r=new a(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var o=new s(r[30]);for(n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)o[i]=i-r[n]<<5|n;return{b:r,r:o}},p=u(i,2),h=p.b,f=p.r;h[28]=258,f[258]=28;for(var d=u(l,0),m=d.b,g=(d.r,new a(32768)),v=0;v<32768;++v){var y=(43690&v)>>1|(21845&v)<<1;y=(61680&(y=(52428&y)>>2|(13107&y)<<2))>>4|(3855&y)<<4,g[v]=((65280&y)>>8|(255&y)<<8)>>1}var w=function(e,t,r){for(var n=e.length,o=0,s=new a(t);o<n;++o)e[o]&&++s[e[o]-1];var i,l=new a(t);for(o=1;o<t;++o)l[o]=l[o-1]+s[o-1]<<1;if(r){i=new a(1<<t);var c=15-t;for(o=0;o<n;++o)if(e[o])for(var u=o<<4|e[o],p=t-e[o],h=l[e[o]-1]++<<p,f=h|(1<<p)-1;h<=f;++h)i[g[h]>>c]=u}else for(i=new a(n),o=0;o<n;++o)e[o]&&(i[o]=g[l[e[o]-1]++]>>15-e[o]);return i},I=new o(288);for(v=0;v<144;++v)I[v]=8;for(v=144;v<256;++v)I[v]=9;for(v=256;v<280;++v)I[v]=7;for(v=280;v<288;++v)I[v]=8;var x=new o(32);for(v=0;v<32;++v)x[v]=5;var b=w(I,9,1),T=w(x,5,1),k=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},P=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},E=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},N=function(e){return(e+7)/8|0},A=function(e,t,r){return(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length),new o(e.subarray(t,r))},D=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],C=function(e,t,r){var n=new Error(t||D[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,C),!r)throw n;return n},M=function(e,t,r,n){var a=e.length,s=n?n.length:0;if(!a||t.f&&!t.l)return r||new o(0);var u=!r,p=u||2!=t.i,f=t.i;u&&(r=new o(3*a));var d=function(e){var t=r.length;if(e>t){var n=new o(Math.max(2*t,e));n.set(r),r=n}},g=t.f||0,v=t.p||0,y=t.b||0,I=t.l,x=t.d,D=t.m,M=t.n,S=8*a;do{if(!I){g=P(e,v,1);var L=P(e,v+1,3);if(v+=3,!L){var F=e[(X=N(v)+4)-4]|e[X-3]<<8,R=X+F;if(R>a){f&&C(0);break}p&&d(y+F),r.set(e.subarray(X,R),y),t.b=y+=F,t.p=v=8*R,t.f=g;continue}if(1==L)I=b,x=T,D=9,M=5;else if(2==L){var O=P(e,v,31)+257,B=P(e,v+10,15)+4,U=O+P(e,v+5,31)+1;v+=14;for(var G=new o(U),V=new o(19),_=0;_<B;++_)V[c[_]]=P(e,v+3*_,7);v+=3*B;var j=k(V),z=(1<<j)-1,W=w(V,j,1);for(_=0;_<U;){var X,H=W[P(e,v,z)];if(v+=15&H,(X=H>>4)<16)G[_++]=X;else{var K=0,$=0;for(16==X?($=3+P(e,v,3),v+=2,K=G[_-1]):17==X?($=3+P(e,v,7),v+=3):18==X&&($=11+P(e,v,127),v+=7);$--;)G[_++]=K}}var Z=G.subarray(0,O),Y=G.subarray(O);D=k(Z),M=k(Y),I=w(Z,D,1),x=w(Y,M,1)}else C(1);if(v>S){f&&C(0);break}}p&&d(y+131072);for(var q=(1<<D)-1,Q=(1<<M)-1,J=v;;J=v){var ee=(K=I[E(e,v)&q])>>4;if((v+=15&K)>S){f&&C(0);break}if(K||C(2),ee<256)r[y++]=ee;else{if(256==ee){J=v,I=null;break}var te=ee-254;if(ee>264){var re=i[_=ee-257];te=P(e,v,(1<<re)-1)+h[_],v+=re}var ne=x[E(e,v)&Q],oe=ne>>4;ne||C(3),v+=15&ne;Y=m[oe];if(oe>3){re=l[oe];Y+=E(e,v)&(1<<re)-1,v+=re}if(v>S){f&&C(0);break}p&&d(y+131072);var ae=y+te;if(y<Y){var se=s-Y,ie=Math.min(Y,ae);for(se+y<0&&C(3);y<ie;++y)r[y]=n[se+y]}for(;y<ae;++y)r[y]=r[y-Y]}}t.l=I,t.p=J,t.b=y,t.f=g,I&&(g=1,t.m=D,t.d=x,t.n=M)}while(!g);return y!=r.length&&u?A(r,0,y):r.subarray(0,y)},S=new o(0),L=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&C(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&C(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function F(e,t){return M(e.subarray(L(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}var R="undefined"!=typeof TextDecoder&&new TextDecoder;try{R.decode(S,{stream:!0}),1}catch(e){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function O(e,t,r){const n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;let o=e,a=n,s=Math.floor((o+a)/2);for(;t<r[s]||t>=r[s+1];)t<r[s]?a=s:o=s,s=Math.floor((o+a)/2);return s}function B(e,t,r,n){const o=[],a=[],s=[];o[0]=1;for(let i=1;i<=r;++i){a[i]=t-n[e+1-i],s[i]=n[e+i]-t;let r=0;for(let e=0;e<i;++e){const t=s[e+1],n=a[i-e],l=o[e]/(t+n);o[e]=r+t*l,r=n*l}o[i]=r}return o}function U(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let n=1;for(let e=2;e<=t;++e)n*=e;for(let r=2;r<=e-t;++r)n*=r;return r/n}function G(e,t,r,o,a){const s=function(e,t,r,o,a){const s=a<e?a:e,i=[],l=O(e,o,t),c=function(e,t,r,n,o){const a=[];for(let e=0;e<=r;++e)a[e]=0;const s=[];for(let e=0;e<=n;++e)s[e]=a.slice(0);const i=[];for(let e=0;e<=r;++e)i[e]=a.slice(0);i[0][0]=1;const l=a.slice(0),c=a.slice(0);for(let n=1;n<=r;++n){l[n]=t-o[e+1-n],c[n]=o[e+n]-t;let r=0;for(let e=0;e<n;++e){const t=c[e+1],o=l[n-e];i[n][e]=t+o;const a=i[e][n-1]/i[n][e];i[e][n]=r+t*a,r=o*a}i[n][n]=r}for(let e=0;e<=r;++e)s[0][e]=i[e][r];for(let e=0;e<=r;++e){let t=0,o=1;const l=[];for(let e=0;e<=r;++e)l[e]=a.slice(0);l[0][0]=1;for(let a=1;a<=n;++a){let n=0;const c=e-a,u=r-a;e>=a&&(l[o][0]=l[t][0]/i[u+1][c],n=l[o][0]*i[c][u]);const p=e-1<=u?a-1:r-e;for(let e=c>=-1?1:-c;e<=p;++e)l[o][e]=(l[t][e]-l[t][e-1])/i[u+1][c+e],n+=l[o][e]*i[c+e][u];e<=u&&(l[o][a]=-l[t][a-1]/i[u+1][e],n+=l[o][a]*i[e][u]),s[a][e]=n;const h=t;t=o,o=h}}let u=r;for(let e=1;e<=n;++e){for(let t=0;t<=r;++t)s[e][t]*=u;u*=r-e}return s}(l,o,e,s,t),u=[];for(let e=0;e<r.length;++e){const t=r[e].clone(),n=t.w;t.x*=n,t.y*=n,t.z*=n,u[e]=t}for(let t=0;t<=s;++t){const r=u[l-e].clone().multiplyScalar(c[t][0]);for(let n=1;n<=e;++n)r.add(u[l-e+n].clone().multiplyScalar(c[t][n]));i[t]=r}for(let e=s+1;e<=a+1;++e)i[e]=new n.Ltg(0,0,0);return i}(e,t,r,o,a);return function(e){const t=e.length,r=[],o=[];for(let a=0;a<t;++a){const t=e[a];r[a]=new n.Pa4(t.x,t.y,t.z),o[a]=t.w}const a=[];for(let e=0;e<t;++e){const t=r[e].clone();for(let r=1;r<=e;++r)t.sub(a[e-r].clone().multiplyScalar(U(e,r)*o[r]));a[e]=t.divideScalar(o[0])}return a}(s)}class V extends n.Hyl{constructor(e,t,r,o,a){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=o||0,this.endKnot=a||this.knots.length-1;for(let e=0;e<r.length;++e){const t=r[e];this.controlPoints[e]=new n.Ltg(t.x,t.y,t.z,t.w)}}getPoint(e,t=new n.Pa4){const r=t,o=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=function(e,t,r,o){const a=O(e,o,t),s=B(a,o,e,t),i=new n.Ltg(0,0,0,0);for(let t=0;t<=e;++t){const n=r[a-e+t],o=s[t],l=n.w*o;i.x+=n.x*l,i.y+=n.y*l,i.z+=n.z*l,i.w+=n.w*o}return i}(this.degree,this.knots,this.controlPoints,o);return 1!==a.w&&a.divideScalar(a.w),r.set(a.x,a.y,a.z)}getTangent(e,t=new n.Pa4){const r=t,o=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=G(this.degree,this.knots,this.controlPoints,o,1);return r.copy(a[1]).normalize(),r}}let _,j,z;class W extends n.aNw{constructor(e){super(e)}load(e,t,r,o){const a=this,s=""===a.path?n.Zp0.extractUrlBase(e):a.path,i=new n.hH6(this.manager);i.setPath(a.path),i.setResponseType("arraybuffer"),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(e,(function(r){try{t(a.parse(r,s))}catch(t){o?o(t):console.error(t),a.manager.itemError(e)}}),r,o)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===ie(e,0,t.length)}(e))_=(new Z).parse(e);else{const t=ie(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let r=0;function n(t){const n=e[t-1];return e=e.slice(r+t),r++,n}for(let e=0;e<t.length;++e){if(n(1)===t[e])return!1}return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(Q(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Q(t));_=(new $).parse(t)}const r=new n.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new X(r,this.manager).parse(_)}}class X{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){j=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),n=this.parseDeformers(),o=(new H).parse(n);return this.parseScene(n,o,r),z}parseConnections(){const e=new Map;if("Connections"in _){_.Connections.connections.forEach((function(t){const r=t[0],n=t[1],o=t[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:n,relationship:o};e.get(r).parents.push(a),e.has(n)||e.set(n,{parents:[],children:[]});const s={ID:r,relationship:o};e.get(n).children.push(s)}))}return e}parseImages(){const e={},t={};if("Video"in _.Objects){const r=_.Objects.Video;for(const n in r){const o=r[n];if(e[parseInt(n)]=o.RelativeFilename||o.Filename,"Content"in o){const e=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,a="string"==typeof o.Content&&""!==o.Content;if(e||a){const e=this.parseImage(r[n]);t[o.RelativeFilename||o.Filename]=e}}}}for(const r in e){const n=e[r];void 0!==t[n]?e[r]=t[n]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const t=e.Content,r=e.RelativeFilename||e.Filename,n=r.slice(r.lastIndexOf(".")+1).toLowerCase();let o;switch(n){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),o="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"==typeof t)return"data:"+o+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:o}))}}parseTextures(e){const t=new Map;if("Texture"in _.Objects){const r=_.Objects.Texture;for(const n in r){const o=this.parseTexture(r[n],e);t.set(parseInt(n),o)}}return t}parseTexture(e,t){const r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;const o=e.WrapModeU,a=e.WrapModeV,s=void 0!==o?o.value:0,i=void 0!==a?a.value:0;if(r.wrapS=0===s?n.rpg:n.uWy,r.wrapT=0===i?n.rpg:n.uWy,"Scaling"in e){const t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;r.offset.x=t[0],r.offset.y=t[1]}return r}loadTexture(e,t){const r=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),o=e.FileName.split(".").pop().toLowerCase(),a=r.has(o)?this.manager.getHandler(`.${o}`):this.textureLoader;if(!a)return console.warn(`FBXLoader: ${o.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new n.xEZ;const s=a.path;s||a.setPath(this.textureLoader.path);const i=j.get(e.id).children;let l;void 0!==i&&i.length>0&&void 0!==t[i[0].ID]&&(l=t[i[0].ID],0!==l.indexOf("blob:")&&0!==l.indexOf("data:")||a.setPath(void 0));const c=a.load(l);return a.setPath(s),c}parseMaterials(e){const t=new Map;if("Material"in _.Objects){const r=_.Objects.Material;for(const n in r){const o=this.parseMaterial(r[n],e);null!==o&&t.set(parseInt(n),o)}}return t}parseMaterial(e,t){const r=e.id,o=e.attrName;let a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!j.has(r))return null;const s=this.parseParameters(e,t,r);let i;switch(a.toLowerCase()){case"phong":i=new n.xoR;break;case"lambert":i=new n.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),i=new n.xoR}return i.setValues(s),i.name=o,i}parseParameters(e,t,r){const o={};e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=n.epp.toWorkingColorSpace((new n.Ilk).fromArray(e.Diffuse.value),n.KI_):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(o.color=n.epp.toWorkingColorSpace((new n.Ilk).fromArray(e.DiffuseColor.value),n.KI_)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.Emissive?o.emissive=n.epp.toWorkingColorSpace((new n.Ilk).fromArray(e.Emissive.value),n.KI_):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(o.emissive=n.epp.toWorkingColorSpace((new n.Ilk).fromArray(e.EmissiveColor.value),n.KI_)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Shininess&&(o.shininess=e.Shininess.value),e.Specular?o.specular=n.epp.toWorkingColorSpace((new n.Ilk).fromArray(e.Specular.value),n.KI_):e.SpecularColor&&"Color"===e.SpecularColor.type&&(o.specular=n.epp.toWorkingColorSpace((new n.Ilk).fromArray(e.SpecularColor.value),n.KI_));const a=this;return j.get(r).children.forEach((function(e){const r=e.relationship;switch(r){case"Bump":o.bumpMap=a.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":o.aoMap=a.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=a.getTexture(t,e.ID),void 0!==o.map&&(o.map.colorSpace=n.KI_);break;case"DisplacementColor":o.displacementMap=a.getTexture(t,e.ID);break;case"EmissiveColor":o.emissiveMap=a.getTexture(t,e.ID),void 0!==o.emissiveMap&&(o.emissiveMap.colorSpace=n.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=a.getTexture(t,e.ID);break;case"ReflectionColor":o.envMap=a.getTexture(t,e.ID),void 0!==o.envMap&&(o.envMap.mapping=n.dSO,o.envMap.colorSpace=n.KI_);break;case"SpecularColor":o.specularMap=a.getTexture(t,e.ID),void 0!==o.specularMap&&(o.specularMap.colorSpace=n.KI_);break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=a.getTexture(t,e.ID),o.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}})),o}getTexture(e,t){return"LayeredTexture"in _.Objects&&t in _.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=j.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in _.Objects){const r=_.Objects.Deformer;for(const n in r){const o=r[n],a=j.get(parseInt(n));if("Skin"===o.attrType){const t=this.parseSkeleton(a,r);t.ID=n,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=a.parents[0].ID,e[n]=t}else if("BlendShape"===o.attrType){const e={id:n};e.rawTargets=this.parseMorphTargets(a,r),e.id=n,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const r=[];return e.children.forEach((function(e){const o=t[e.ID];if("Cluster"!==o.attrType)return;const a={ID:e.ID,indices:[],weights:[],transformLink:(new n.yGw).fromArray(o.TransformLink.a)};"Indexes"in o&&(a.indices=o.Indexes.a,a.weights=o.Weights.a),r.push(a)})),{rawBones:r,bones:[]}}parseMorphTargets(e,t){const r=[];for(let n=0;n<e.children.length;n++){const o=e.children[n],a=t[o.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;s.geoID=j.get(parseInt(o.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(s)}return r}parseScene(e,t,r){z=new n.ZAu;const o=this.parseModels(e.skeletons,t,r),a=_.Objects.Model,s=this;o.forEach((function(e){const t=a[e.ID];s.setLookAtProperties(e,t);j.get(e.ID).parents.forEach((function(t){const r=o.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&z.add(e)})),this.bindSkeleton(e.skeletons,t,o),this.addGlobalSceneSettings(),z.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=oe(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const i=(new K).parse();1===z.children.length&&z.children[0].isGroup&&(z.children[0].animations=i,z=z.children[0]),z.animations=i}parseModels(e,t,r){const o=new Map,a=_.Objects.Model;for(const s in a){const i=parseInt(s),l=a[s],c=j.get(i);let u=this.buildSkeleton(c,e,i,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,r);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new n.N$j;break;default:u=new n.ZAu}u.name=l.attrName?n.iUV.sanitizeNodeName(l.attrName):"",u.userData.originalName=l.attrName,u.ID=i}this.getTransformData(u,l),o.set(i,u)}return o}buildSkeleton(e,t,r,o){let a=null;return e.parents.forEach((function(e){for(const s in t){const i=t[s];i.rawBones.forEach((function(t,s){if(t.ID===e.ID){const e=a;a=new n.N$j,a.matrixWorld.copy(t.transformLink),a.name=o?n.iUV.sanitizeNodeName(o):"",a.userData.originalName=o,a.ID=r,i.bones[s]=a,null!==e&&a.add(e)}}))}})),a}createCamera(e){let t,r;if(e.children.forEach((function(e){const t=_.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)t=new n.Tme;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let o=1;void 0!==r.NearPlane&&(o=r.NearPlane.value/1e3);let a=1e3;void 0!==r.FarPlane&&(a=r.FarPlane.value/1e3);let s=window.innerWidth,i=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(s=r.AspectWidth.value,i=r.AspectHeight.value);const l=s/i;let c=45;void 0!==r.FieldOfView&&(c=r.FieldOfView.value);const u=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new n.cPb(c,l,o,a),null!==u&&t.setFocalLength(u);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new n.Tme;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new n.Tme}}return t}createLight(e){let t,r;if(e.children.forEach((function(e){const t=_.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)t=new n.Tme;else{let e;e=void 0===r.LightType?0:r.LightType.value;let o=16777215;void 0!==r.Color&&(o=n.epp.toWorkingColorSpace((new n.Ilk).fromArray(r.Color.value),n.KI_));let a=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(a=0);let s=0;void 0!==r.FarAttenuationEnd&&(s=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);const i=1;switch(e){case 0:t=new n.cek(o,a,s,i);break;case 1:t=new n.Ox3(o,a);break;case 2:let e=Math.PI/3;void 0!==r.InnerAngle&&(e=n.M8C.degToRad(r.InnerAngle.value));let l=0;void 0!==r.OuterAngle&&(l=n.M8C.degToRad(r.OuterAngle.value),l=Math.max(l,1)),t=new n.PMe(o,a,s,e,l,i);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new n.cek(o,a)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let o,a=null,s=null;const i=[];return e.children.forEach((function(e){t.has(e.ID)&&(a=t.get(e.ID)),r.has(e.ID)&&i.push(r.get(e.ID))})),i.length>1?s=i:i.length>0?s=i[0]:(s=new n.xoR({name:n.aNw.DEFAULT_MATERIAL_NAME,color:13421772}),i.push(s)),"color"in a.attributes&&i.forEach((function(e){e.vertexColors=!0})),a.FBX_Deformer?(o=new n.TUv(a,s),o.normalizeSkinWeights()):o=new n.Kj0(a,s),o}createCurve(e,t){const r=e.children.reduce((function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e}),null),o=new n.nls({name:n.aNw.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new n.x12(r,o)}getTransformData(e,t){const r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder=ae("RotationOrder"in t?t.RotationOrder.value:0),"Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){if("LookAtProperty"in t){j.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const r=_.Objects.Model[t.ID];if("Lcl_Translation"in r){const t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),z.add(e.target)):e.lookAt((new n.Pa4).fromArray(t))}}}))}}bindSkeleton(e,t,r){const o=this.parsePoseNodes();for(const a in e){const s=e[a];j.get(parseInt(s.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;j.get(t).parents.forEach((function(e){if(r.has(e.ID)){r.get(e.ID).bind(new n.OdW(s.bones),o[e.ID])}}))}}))}}parsePoseNodes(){const e={};if("Pose"in _.Objects){const t=_.Objects.Pose;for(const r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){const o=t[r].PoseNode;Array.isArray(o)?o.forEach((function(t){e[t.Node]=(new n.yGw).fromArray(t.Matrix.a)})):e[o.Node]=(new n.yGw).fromArray(o.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in _){if("AmbientColor"in _.GlobalSettings){const e=_.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],o=e[2];if(0!==t||0!==r||0!==o){const e=(new n.Ilk).setRGB(t,r,o,n.KI_);z.add(new n.Mig(e,1))}}"UnitScaleFactor"in _.GlobalSettings&&(z.userData.unitScaleFactor=_.GlobalSettings.UnitScaleFactor.value)}}}class H{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in _.Objects){const r=_.Objects.Geometry;for(const n in r){const o=j.get(parseInt(n)),a=this.parseGeometry(o,r[n],e);t.set(parseInt(n),a)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){const n=r.skeletons,o=[],a=e.parents.map((function(e){return _.Objects.Model[e.ID]}));if(0===a.length)return;const s=e.children.reduce((function(e,t){return void 0!==n[t.ID]&&(e=n[t.ID]),e}),null);e.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&o.push(r.morphTargets[e.ID])}));const i=a[0],l={};"RotationOrder"in i&&(l.eulerOrder=ae(i.RotationOrder.value)),"InheritType"in i&&(l.inheritType=parseInt(i.InheritType.value)),"GeometricTranslation"in i&&(l.translation=i.GeometricTranslation.value),"GeometricRotation"in i&&(l.rotation=i.GeometricRotation.value),"GeometricScaling"in i&&(l.scale=i.GeometricScaling.value);const c=oe(l);return this.genGeometry(t,s,o,c)}genGeometry(e,t,r,o){const a=new n.u9r;e.attrName&&(a.name=e.attrName);const s=this.parseGeoNode(e,t),i=this.genBuffers(s),l=new n.a$l(i.vertex,3);if(l.applyMatrix4(o),a.setAttribute("position",l),i.colors.length>0&&a.setAttribute("color",new n.a$l(i.colors,3)),t&&(a.setAttribute("skinIndex",new n.qlB(i.weightsIndices,4)),a.setAttribute("skinWeight",new n.a$l(i.vertexWeights,4)),a.FBX_Deformer=t),i.normal.length>0){const e=(new n.Vkp).getNormalMatrix(o),t=new n.a$l(i.normal,3);t.applyNormalMatrix(e),a.setAttribute("normal",t)}if(i.uvs.forEach((function(e,t){const r=0===t?"uv":`uv${t}`;a.setAttribute(r,new n.a$l(i.uvs[t],2))})),s.material&&"AllSame"!==s.material.mappingType){let e=i.materialIndex[0],t=0;if(i.materialIndex.forEach((function(r,n){r!==e&&(a.addGroup(t,n-t,e),e=r,t=n)})),a.groups.length>0){const t=a.groups[a.groups.length-1],r=t.start+t.count;r!==i.materialIndex.length&&a.addGroup(r,i.materialIndex.length-r,e)}0===a.groups.length&&a.addGroup(0,i.materialIndex.length,i.materialIndex[0])}return this.addMorphTargets(a,e,r,o),a}parseGeoNode(e,t){const r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,o){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[o]})}))}))),r}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,n=0,o=!1,a=[],s=[],i=[],l=[],c=[],u=[];const p=this;return e.vertexIndices.forEach((function(h,f){let d,m=!1;h<0&&(h^=-1,m=!0);let g=[],v=[];if(a.push(3*h,3*h+1,3*h+2),e.color){const t=te(f,r,h,e.color);i.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const e=[0,0,0,0],t=[0,0,0,0];v.forEach((function(r,n){let o=r,a=g[n];t.forEach((function(t,r,n){if(o>t){n[r]=o,o=t;const s=e[r];e[r]=a,a=s}}))})),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)c.push(v[e]),u.push(g[e])}if(e.normal){const t=te(f,r,h,e.normal);s.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(d=te(f,r,h,e.material)[0],d<0&&(p.negativeMaterialIndices=!0,d=0)),e.uv&&e.uv.forEach((function(e,t){const n=te(f,r,h,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])})),n++,m&&(p.genFace(t,e,a,d,s,i,l,c,u,n),r++,n=0,a=[],s=[],i=[],l=[],c=[],u=[])})),t}getNormalNewell(e){const t=new n.Pa4(0,0,0);for(let r=0;r<e.length;r++){const n=e[r],o=e[(r+1)%e.length];t.x+=(n.y-o.y)*(n.z+o.z),t.y+=(n.z-o.z)*(n.x+o.x),t.z+=(n.x-o.x)*(n.y+o.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),r=(Math.abs(t.z)>.5?new n.Pa4(0,1,0):new n.Pa4(0,0,1)).cross(t).normalize(),o=t.clone().cross(r).normalize();return{normal:t,tangent:r,bitangent:o}}flattenVertex(e,t,r){return new n.FM8(e.dot(t),e.dot(r))}genFace(e,t,r,o,a,s,i,l,c,u){let p;if(u>3){const e=[],o=t.baseVertexPositions||t.vertexPositions;for(let t=0;t<r.length;t+=3)e.push(new n.Pa4(o[r[t]],o[r[t+1]],o[r[t+2]]));const{tangent:a,bitangent:s}=this.getNormalTangentAndBitangent(e),i=[];for(const t of e)i.push(this.flattenVertex(t,a,s));p=n.iDF.triangulateShape(i,[])}else p=[[0,1,2]];for(const[n,u,h]of p)e.vertex.push(t.vertexPositions[r[3*n]]),e.vertex.push(t.vertexPositions[r[3*n+1]]),e.vertex.push(t.vertexPositions[r[3*n+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),e.vertex.push(t.vertexPositions[r[3*h]]),e.vertex.push(t.vertexPositions[r[3*h+1]]),e.vertex.push(t.vertexPositions[r[3*h+2]]),t.skeleton&&(e.vertexWeights.push(l[4*n]),e.vertexWeights.push(l[4*n+1]),e.vertexWeights.push(l[4*n+2]),e.vertexWeights.push(l[4*n+3]),e.vertexWeights.push(l[4*u]),e.vertexWeights.push(l[4*u+1]),e.vertexWeights.push(l[4*u+2]),e.vertexWeights.push(l[4*u+3]),e.vertexWeights.push(l[4*h]),e.vertexWeights.push(l[4*h+1]),e.vertexWeights.push(l[4*h+2]),e.vertexWeights.push(l[4*h+3]),e.weightsIndices.push(c[4*n]),e.weightsIndices.push(c[4*n+1]),e.weightsIndices.push(c[4*n+2]),e.weightsIndices.push(c[4*n+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3]),e.weightsIndices.push(c[4*h]),e.weightsIndices.push(c[4*h+1]),e.weightsIndices.push(c[4*h+2]),e.weightsIndices.push(c[4*h+3])),t.color&&(e.colors.push(s[3*n]),e.colors.push(s[3*n+1]),e.colors.push(s[3*n+2]),e.colors.push(s[3*u]),e.colors.push(s[3*u+1]),e.colors.push(s[3*u+2]),e.colors.push(s[3*h]),e.colors.push(s[3*h+1]),e.colors.push(s[3*h+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(o),e.materialIndex.push(o),e.materialIndex.push(o)),t.normal&&(e.normal.push(a[3*n]),e.normal.push(a[3*n+1]),e.normal.push(a[3*n+2]),e.normal.push(a[3*u]),e.normal.push(a[3*u+1]),e.normal.push(a[3*u+2]),e.normal.push(a[3*h]),e.normal.push(a[3*h+1]),e.normal.push(a[3*h+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(i[r][2*n]),e.uvs[r].push(i[r][2*n+1]),e.uvs[r].push(i[r][2*u]),e.uvs[r].push(i[r][2*u+1]),e.uvs[r].push(i[r][2*h]),e.uvs[r].push(i[r][2*h+1])}))}addMorphTargets(e,t,r,n){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;r.forEach((function(r){r.rawTargets.forEach((function(r){const a=_.Objects.Geometry[r.geoID];void 0!==a&&o.genMorphGeometry(e,t,a,n,r.name)}))}))}genMorphGeometry(e,t,r,o,a){const s=void 0!==t.Vertices?t.Vertices.a:[],i=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],l=void 0!==r.Vertices?r.Vertices.a:[],c=void 0!==r.Indexes?r.Indexes.a:[],u=3*e.attributes.position.count,p=new Float32Array(u);for(let e=0;e<c.length;e++){const t=3*c[e];p[t]=l[3*e],p[t+1]=l[3*e+1],p[t+2]=l[3*e+2]}const h={vertexIndices:i,vertexPositions:p,baseVertexPositions:s},f=this.genBuffers(h),d=new n.a$l(f.vertex,3);d.name=a||r.attrName,d.applyMatrix4(o),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a;let o=[];return"IndexToDirect"===r&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:o,mappingType:t,referenceType:r}}parseUVs(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a;let o=[];return"IndexToDirect"===r&&(o=e.UVIndex.a),{dataSize:2,buffer:n,indices:o,mappingType:t,referenceType:r}}parseVertexColors(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,o=e.Colors.a;let a=[];"IndexToDirect"===r&&(a=e.ColorIndex.a);for(let e=0,t=new n.Ilk;e<o.length;e+=4)t.fromArray(o,e),n.epp.toWorkingColorSpace(t,n.KI_),t.toArray(o,e);return{dataSize:4,buffer:o,indices:a,mappingType:t,referenceType:r}}parseMaterialIndices(e){const t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const n=e.Materials.a,o=[];for(let e=0;e<n.length;++e)o.push(e);return{dataSize:1,buffer:n,indices:o,mappingType:t,referenceType:r}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new n.u9r;const r=t-1,o=e.KnotVector.a,a=[],s=e.Points.a;for(let e=0,t=s.length;e<t;e+=4)a.push((new n.Ltg).fromArray(s,e));let i,l;if("Closed"===e.Form)a.push(a[0]);else if("Periodic"===e.Form){i=r,l=o.length-1-i;for(let e=0;e<r;++e)a.push(a[e])}const c=new V(r,o,a,i,l).getPoints(12*a.length);return(new n.u9r).setFromPoints(c)}}class K{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const r in t){const n=t[r],o=this.addClip(n);e.push(o)}return e}parseClips(){if(void 0===_.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=_.Objects.AnimationCurveNode,t=new Map;for(const r in e){const n=e[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){const e={id:n.id,attr:n.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=_.Objects.AnimationCurve;for(const r in t){const n={id:t[r].id,times:t[r].KeyTime.a.map(J),values:t[r].KeyValueFloat.a},o=j.get(n.id);if(void 0!==o){const t=o.parents[0].ID,r=o.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=n:r.match(/Y/)?e.get(t).curves.y=n:r.match(/Z/)?e.get(t).curves.z=n:r.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=n)}}}parseAnimationLayers(e){const t=_.Objects.AnimationLayer,r=new Map;for(const o in t){const t=[],a=j.get(parseInt(o));if(void 0!==a){a.children.forEach((function(r,o){if(e.has(r.ID)){const a=e.get(r.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===t[o]){const e=j.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const a=_.Objects.Model[e.toString()];if(void 0===a)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",r);const s={modelName:a.attrName?n.iUV.sanitizeNodeName(a.attrName):"",ID:a.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};z.traverse((function(e){e.ID===a.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new n.yGw),"PreRotation"in a&&(s.preRotation=a.PreRotation.value),"PostRotation"in a&&(s.postRotation=a.PostRotation.value),t[o]=s}}t[o]&&(t[o][a.attr]=a)}else if(void 0!==a.curves.morph){if(void 0===t[o]){const e=j.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,a=j.get(e).parents[0].ID,s=j.get(a).parents[0].ID,i=j.get(s).parents[0].ID,l=_.Objects.Model[i],c={modelName:l.attrName?n.iUV.sanitizeNodeName(l.attrName):"",morphName:_.Objects.Deformer[e].attrName};t[o]=c}t[o][a.attr]=a}}})),r.set(parseInt(o),t)}}return r}parseAnimStacks(e){const t=_.Objects.AnimationStack,r={};for(const n in t){const o=j.get(parseInt(n)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(o[0].ID);r[n]={name:t[n].attrName,layer:a}}return r}addClip(e){let t=[];const r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new n.m7l(e.name,-1,t)}generateTracks(e){const t=[];let r=new n.Pa4,o=new n.Pa4;if(e.transform&&e.transform.decompose(r,new n._fP,o),r=r.toArray(),o=o.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==n&&t.push(n)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){const r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,o){const a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,r);return new n.yC1(e+"."+o,a,s)}generateRotationTrack(e,t,r,o,a){let s,i;if(void 0!==t.x&&void 0!==t.y&&void 0!==t.z){const e=this.interpolateRotations(t.x,t.y,t.z,a);s=e[0],i=e[1]}const l=ae(0);void 0!==r&&((r=r.map(n.M8C.degToRad)).push(l),r=(new n.USm).fromArray(r),r=(new n._fP).setFromEuler(r)),void 0!==o&&((o=o.map(n.M8C.degToRad)).push(l),o=(new n.USm).fromArray(o),o=(new n._fP).setFromEuler(o).invert());const c=new n._fP,u=new n.USm,p=[];if(!i||!s)return new n.iLg(e+".quaternion",[0],[0]);for(let e=0;e<i.length;e+=3){if(u.set(i[e],i[e+1],i[e+2],a),c.setFromEuler(u),void 0!==r&&c.premultiply(r),void 0!==o&&c.multiply(o),e>2){(new n._fP).fromArray(p,(e-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w)}c.toArray(p,e/3*4)}return new n.iLg(e+".quaternion",s,p)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,r=t.values.map((function(e){return e/100})),o=z.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new n.dUE(e.modelName+".morphTargetInfluences["+o+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,r=t[0];for(let n=1;n<t.length;n++){const o=t[n];o!==r&&(t[e]=o,r=o,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){const n=r,o=[];let a=-1,s=-1,i=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(i=t.z.times.indexOf(e)),-1!==a){const e=t.x.values[a];o.push(e),n[0]=e}else o.push(n[0]);if(-1!==s){const e=t.y.values[s];o.push(e),n[1]=e}else o.push(n[1]);if(-1!==i){const e=t.z.values[i];o.push(e),n[2]=e}else o.push(n[2])})),o}interpolateRotations(e,t,r,o){const a=[],s=[];a.push(e.times[0]),s.push(n.M8C.degToRad(e.values[0])),s.push(n.M8C.degToRad(t.values[0])),s.push(n.M8C.degToRad(r.values[0]));for(let i=1;i<e.values.length;i++){const l=[e.values[i-1],t.values[i-1],r.values[i-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(n.M8C.degToRad),u=[e.values[i],t.values[i],r.values[i]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const p=u.map(n.M8C.degToRad),h=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],f=[Math.abs(h[0]),Math.abs(h[1]),Math.abs(h[2])];if(f[0]>=180||f[1]>=180||f[2]>=180){const t=Math.max(...f)/180,r=new n.USm(...c,o),l=new n.USm(...p,o),u=(new n._fP).setFromEuler(r),h=(new n._fP).setFromEuler(l);u.dot(h)&&h.set(-h.x,-h.y,-h.z,-h.w);const d=e.times[i-1],m=e.times[i]-d,g=new n._fP,v=new n.USm;for(let e=0;e<1;e+=1/t)g.copy(u.clone().slerp(h.clone(),e)),a.push(d+e*m),v.setFromQuaternion(g,o),s.push(v.x),s.push(v.y),s.push(v.z)}else a.push(e.times[i]),s.push(n.M8C.degToRad(e.values[i])),s.push(n.M8C.degToRad(t.values[i])),s.push(n.M8C.degToRad(r.values[i]))}return[a,s]}}class ${getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new q,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,n){const o=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(o||a)return;const s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),i=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):i?t.parseNodeProperty(e,i,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),o={name:r},a=this.parseNodeAttr(n),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,o):r in s?("PoseNode"===r?s.PoseNode.push(o):void 0!==s[r].id&&(s[r]={},s[r][s[r].id]=s[r]),""!==a.id&&(s[r][a.id]=o)):"number"==typeof a.id?(s[r]={},s[r][a.id]=o):"Properties70"!==r&&(s[r]="PoseNode"===r?[o]:o),"number"==typeof a.id&&(o.id=a.id),""!==a.name&&(o.attrName=a.name),""!==a.type&&(o.attrType=a.type),this.pushStack(o)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}}parseNodeProperty(e,t,r){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),o=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===o&&(o=r.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===n){const e=o.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]);let s=o.split(",").slice(3);s=s.map((function(e){return e.trim().replace(/^"/,"")})),n="connections",o=[t,r],function(e,t){for(let r=0,n=e.length,o=t.length;r<o;r++,n++)e[n]=t[r]}(o,s),void 0===a[n]&&(a[n]=[])}"Node"===n&&(a.id=o),n in a&&Array.isArray(a[n])?a[n].push(o):"a"!==n?a[n]=o:a.a=o,this.setCurrentProp(a,n),"a"===n&&","!==o.slice(-1)&&(a.a=se(o))}else this.parseNodeSpecialProperty(e,n,o)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=se(t.a))}parseNodeSpecialProperty(e,t,r){const n=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),o=n[0],a=n[1],s=n[2],i=n[3];let l=n[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=se(l)}this.getPrevNode()[o]={type:a,type2:s,flag:i,value:l},this.setCurrentProp(this.getPrevNode(),o)}}class Z{parse(e){const t=new Y(e);t.skip(23);const r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const n=new q;for(;!this.endOfContent(t);){const e=this.parseNode(t,r);null!==e&&n.add(e.name,e)}return n}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const r={},n=t>=7500?e.getUint64():e.getUint32(),o=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),s=e.getString(a);if(0===n)return null;const i=[];for(let t=0;t<o;t++)i.push(this.parseProperty(e));const l=i.length>0?i[0]:"",c=i.length>1?i[1]:"",u=i.length>2?i[2]:"";for(r.singleProperty=1===o&&e.getOffset()===n;n>e.getOffset();){const n=this.parseNode(e,t);null!==n&&this.parseSubNode(s,r,n)}return r.propertyList=i,"number"==typeof l&&(r.id=l),""!==c&&(r.attrName=c),""!==u&&(r.attrType=u),""!==s&&(r.name=s),r}parseSubNode(e,t,r){if(!0===r.singleProperty){const e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){const e=[];r.propertyList.forEach((function(t,r){0!==r&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){let e=r.propertyList[0],n=r.propertyList[1];const o=r.propertyList[2],a=r.propertyList[3];let s;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),s="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[e]={type:n,type2:o,flag:a,value:s}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){const t=e.getString(1);let r;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),o=e.getUint32(),a=e.getUint32();if(0===o)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}const s=F(new Uint8Array(e.getArrayBuffer(a))),i=new Y(s.buffer);switch(t){case"b":case"c":return i.getBooleanArray(n);case"d":return i.getFloat64Array(n);case"f":return i.getFloat32Array(n);case"i":return i.getInt32Array(n);case"l":return i.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Y{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let r=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const n=r.indexOf(0);return n>=0&&(r=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(r)}}class q{add(e,t){this[e]=t}}function Q(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function J(e){return e/46186158e3}const ee=[];function te(e,t,r,n){let o;switch(n.mappingType){case"ByPolygonVertex":o=e;break;case"ByPolygon":o=t;break;case"ByVertice":o=r;break;case"AllSame":o=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(o=n.indices[o]);const a=o*n.dataSize,s=a+n.dataSize;return function(e,t,r,n){for(let o=r,a=0;o<n;o++,a++)e[a]=t[o];return e}(ee,n.buffer,a,s)}const re=new n.USm,ne=new n.Pa4;function oe(e){const t=new n.yGw,r=new n.yGw,o=new n.yGw,a=new n.yGw,s=new n.yGw,i=new n.yGw,l=new n.yGw,c=new n.yGw,u=new n.yGw,p=new n.yGw,h=new n.yGw,f=new n.yGw,d=e.inheritType?e.inheritType:0;e.translation&&t.setPosition(ne.fromArray(e.translation));const m=ae(0);if(e.preRotation){const t=e.preRotation.map(n.M8C.degToRad);t.push(m),r.makeRotationFromEuler(re.fromArray(t))}if(e.rotation){const t=e.rotation.map(n.M8C.degToRad);t.push(e.eulerOrder||m),o.makeRotationFromEuler(re.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(n.M8C.degToRad);t.push(m),a.makeRotationFromEuler(re.fromArray(t)),a.invert()}e.scale&&s.scale(ne.fromArray(e.scale)),e.scalingOffset&&l.setPosition(ne.fromArray(e.scalingOffset)),e.scalingPivot&&i.setPosition(ne.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(ne.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(ne.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),p.copy(e.parentMatrixWorld));const g=r.clone().multiply(o).multiply(a),v=new n.yGw;v.extractRotation(p);const y=new n.yGw;y.copyPosition(p);const w=y.clone().invert().multiply(p),I=v.clone().invert().multiply(w),x=s,b=new n.yGw;if(0===d)b.copy(v).multiply(g).multiply(I).multiply(x);else if(1===d)b.copy(v).multiply(I).multiply(g).multiply(x);else{const e=(new n.yGw).scale((new n.Pa4).setFromMatrixScale(h)).clone().invert(),t=I.clone().multiply(e);b.copy(v).multiply(g).multiply(t).multiply(x)}const T=u.clone().invert(),k=i.clone().invert();let P=t.clone().multiply(c).multiply(u).multiply(r).multiply(o).multiply(a).multiply(T).multiply(l).multiply(i).multiply(s).multiply(k);const E=(new n.yGw).copyPosition(P),N=p.clone().multiply(E);return f.copyPosition(N),P=f.clone().multiply(b),P.premultiply(p.invert()),P}function ae(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function se(e){return e.split(",").map((function(e){return parseFloat(e)}))}function ie(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,r))}}}]);